<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <meta name="description" content="Discover and participate in charity events to make a difference in your community">
    <meta name="keywords" content="charity, events, fundraising, volunteer, donate">
    <title>CharityEvents - Make a Difference Through Meaningful Events</title>
    
    <!-- CSSÊ†∑ÂºèË°® -->
    <link rel="stylesheet" href="css/style.css">
    <link rel="stylesheet" href="css/components.css">
    <link rel="stylesheet" href="css/responsive.css">
    
    <!-- ÁΩëÁ´ôÂõæÊ†á -->
    <link rel="icon" type="image/x-icon" href="assets/icons/favicon.ico">
    
    <style>
        .hidden { display: none !important; }
        .loading-spinner {
            width: 40px;
            height: 40px;
            border: 3px solid #f3f3f3;
            border-top: 3px solid #3498db;
            border-radius: 50%;
            animation: spin 1s linear infinite;
            margin: 0 auto 20px;
        }
        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }
        
        /* ‰øÆÂ§çbackdrop-filterÂÖºÂÆπÊÄß */
        .modal-overlay {
            -webkit-backdrop-filter: blur(4px);
            backdrop-filter: blur(4px);
        }
        .navbar.scrolled {
            -webkit-backdrop-filter: blur(10px);
            backdrop-filter: blur(10px);
        }
    </style>
</head>
<body>
    <!-- ÂØºËà™Ê†è -->
    <header>
        <nav class="navbar" role="navigation" aria-label="Main navigation">
            <div class="nav-container">
                <!-- ÁΩëÁ´ôÊ†áÂøó -->
                <a href="index.html" class="nav-logo" aria-label="CharityEvents Home">
                    <span class="logo-icon">‚ù§Ô∏è</span>
                    CharityEvents
                </a>
                
                <!-- ÂØºËà™ËèúÂçï -->
                <ul class="nav-menu" role="menubar">
                    <li class="nav-item" role="none">
                        <a href="index.html" class="nav-link" role="menuitem" aria-current="page">Home</a>
                    </li>
                    <li class="nav-item" role="none">
                        <a href="search.html" class="nav-link" role="menuitem">Search Events</a>
                    </li>
                </ul>
            </div>
        </nav>
    </header>

    <!-- ‰∏ªÂÜÖÂÆπÂå∫Âüü -->
    <main class="main-content" role="main">
        <!-- Ëã±ÈõÑÂå∫Âüü -->
        <section class="hero" aria-labelledby="hero-heading">
            <div class="hero-content">
                <h1 id="hero-heading">Make a Difference Through Charity Events</h1>
                <p class="hero-subtitle">Join meaningful events that create positive change in our community</p>
                <div class="hero-actions">
                    <a href="#upcoming-events" class="btn btn-primary">View Upcoming Events</a>
                    <a href="search.html" class="btn btn-secondary">Find Specific Events</a>
                </div>
            </div>
        </section>

        <!-- ÁªÑÁªá‰ø°ÊÅØÂå∫Âüü -->
        <section class="organization-info" aria-labelledby="about-heading">
            <div class="container">
                <h2 id="about-heading" class="section-title">About Our Mission</h2>
                <div class="mission-content">
                    <div class="mission-text">
                        <p>At CharityEvents, we believe that everyone can make a difference. We connect compassionate individuals and organizations with meaningful charity events that create lasting positive impact in our community.</p>
                        <p>Since our founding, we've helped raise over <strong>$2 million</strong> for various causes and connected <strong>50,000+ participants</strong> with opportunities to give back.</p>
                    </div>
                    <div class="mission-stats">
                        <div class="stat">
                            <span class="stat-number">500+</span>
                            <span class="stat-label">Events Hosted</span>
                        </div>
                        <div class="stat">
                            <span class="stat-number">$2M+</span>
                            <span class="stat-label">Funds Raised</span>
                        </div>
                        <div class="stat">
                            <span class="stat-number">50K+</span>
                            <span class="stat-label">Participants</span>
                        </div>
                    </div>
                </div>
            </div>
        </section>

        <!-- Âä®ÊÄÅÊ¥ªÂä®ÂàóË°®Âå∫Âüü -->
        <section id="upcoming-events" class="events-section" aria-labelledby="events-heading">
            <div class="container">
                <div class="section-header">
                    <h2 id="events-heading" class="section-title">Upcoming Charity Events</h2>
                    <p class="section-subtitle">Discover opportunities to make a difference</p>
                </div>
                
                <!-- Âä†ËΩΩÁä∂ÊÄÅ -->
                <div id="loading-state" class="loading-state">
                    <div class="loading-spinner"></div>
                    <p>Loading upcoming events...</p>
                </div>
                
                <!-- ÈîôËØØÁä∂ÊÄÅ -->
                <div id="error-state" class="error-state hidden" aria-live="assertive" role="alert">
                    <div class="error-icon">‚ö†Ô∏è</div>
                    <h3>Unable to Load Events</h3>
                    <p id="error-message">We're having trouble loading the events. Please check your connection and try again.</p>
                    <button id="retry-button" class="btn btn-primary" onclick="retryLoading()">Retry</button>
                </div>
                
                <!-- Á©∫Áä∂ÊÄÅ -->
                <div id="empty-state" class="empty-state hidden">
                    <div class="empty-icon">üìÖ</div>
                    <h3>No Upcoming Events</h3>
                    <p>There are no upcoming events at the moment. Please check back later for new opportunities to make a difference.</p>
                </div>
                
                <!-- Ê¥ªÂä®ÁΩëÊ†ºÂÆπÂô® -->
                <div id="events-container" class="events-grid hidden"></div>
            </div>
        </section>
    </main>

    <!-- È°µËÑö -->
    <footer class="footer" role="contentinfo">
        <div class="container">
            <div class="footer-content">
                <div class="footer-section">
                    <h3>CharityEvents</h3>
                    <p>Connecting people with meaningful charity opportunities since 2024.</p>
                </div>
                <div class="footer-section">
                    <h4>Quick Links</h4>
                    <ul class="footer-links">
                        <li><a href="index.html">Home</a></li>
                        <li><a href="search.html">Search Events</a></li>
                    </ul>
                </div>
                <div class="footer-section">
                    <h4>Contact Us</h4>
                    <div class="contact-info">
                        <p>üìß Email: <a href="mailto:info@charityevents.org">info@charityevents.org</a></p>
                        <p>üìû Phone: <a href="tel:+15551234567">(555) 123-4567</a></p>
                        <p>üìç Address: 123 Charity Street, Hope City</p>
                    </div>
                </div>
                <div class="footer-section">
                    <h4>Follow Us</h4>
                    <div class="social-links">
                        <a href="#" aria-label="Facebook" class="social-link">üìò Facebook</a>
                        <a href="#" aria-label="Twitter" class="social-link">üê¶ Twitter</a>
                        <a href="#" aria-label="Instagram" class="social-link">üì∑ Instagram</a>
                    </div>
                </div>
            </div>
            <div class="footer-bottom">
                <p>&copy; 2024 CharityEvents. All rights reserved.</p>
            </div>
        </div>
    </footer>

    <!-- ‰øÆÂ§çËÑöÊú¨ - Áõ¥Êé•ÂÜÖËÅîÁ°Æ‰øùÊâßË°å -->
    <script>
        // Â∑•ÂÖ∑ÂáΩÊï∞
        function escapeHtml(text) {
            if (!text) return '';
            const div = document.createElement('div');
            div.textContent = text;
            return div.innerHTML;
        }

        function formatCurrency(amount) {
            if (!amount) return '$0.00';
            return new Intl.NumberFormat('en-US', {
                style: 'currency',
                currency: 'USD'
            }).format(amount);
        }

        function formatDate(dateString) {
            try {
                const date = new Date(dateString);
                return date.toLocaleDateString('en-US', {
                    weekday: 'short',
                    year: 'numeric',
                    month: 'short',
                    day: 'numeric',
                    hour: '2-digit',
                    minute: '2-digit'
                });
            } catch (e) {
                return 'Invalid Date';
            }
        }

        function calculateProgress(current, total) {
            if (!total || total === 0) return 0;
            return Math.min(100, Math.round((current / total) * 100));
        }

        // ÊòæÁ§∫Ê¥ªÂä®Êï∞ÊçÆ
        function displayEvents(events) {
            console.log('üé® Displaying events:', events);
            
            const container = document.getElementById('events-container');
            const loading = document.getElementById('loading-state');
            const error = document.getElementById('error-state');
            const empty = document.getElementById('empty-state');
            
            // ÈöêËóèÂÖ∂‰ªñÁä∂ÊÄÅ
            if (loading) loading.classList.add('hidden');
            if (error) error.classList.add('hidden');
            if (empty) empty.classList.add('hidden');
            
            // ÊòæÁ§∫ÂÆπÂô®
            if (container) {
                container.classList.remove('hidden');
                
                // ÁîüÊàêÊ¥ªÂä®Âç°ÁâáHTML
                const eventsHTML = events.map(event => `
                    <div class="event-card">
                        <div class="event-card-header">
                            <span class="event-category">${escapeHtml(event.category_name || 'Uncategorized')}</span>
                            <span class="event-price">${formatCurrency(event.ticket_price)}</span>
                        </div>
                        
                        <h3 class="event-title">${escapeHtml(event.name)}</h3>
                        
                        <div class="event-meta">
                            <div class="event-date">
                                <span class="meta-icon">üìÖ</span>
                                <time>${formatDate(event.date_time)}</time>
                            </div>
                            
                            <div class="event-location">
                                <span class="meta-icon">üìç</span>
                                <span>${escapeHtml(event.location)}</span>
                            </div>
                        </div>
                        
                        <p class="event-description">${escapeHtml(event.short_description)}</p>
                        
                        ${event.goal_amount > 0 ? `
                        <div class="fundraising-progress">
                            <div class="progress-bar">
                                <div class="progress-fill" style="width: ${calculateProgress(event.current_amount, event.goal_amount)}%"></div>
                            </div>
                            <div class="progress-text">
                                <span>${formatCurrency(event.current_amount)} raised</span>
                                <span>${calculateProgress(event.current_amount, event.goal_amount)}%</span>
                            </div>
                        </div>
                        ` : ''}
                        
                        <div class="event-actions">
                            <button class="view-details-btn" onclick="window.location.href='event.html?id=${event.id}'">
                                View Details
                            </button>
                        </div>
                    </div>
                `).join('');
                
                container.innerHTML = eventsHTML;
            }
        }

        function showNoEvents() {
            const loading = document.getElementById('loading-state');
            const empty = document.getElementById('empty-state');
            
            if (loading) loading.classList.add('hidden');
            if (empty) empty.classList.remove('hidden');
        }

        function showConnectionError() {
            const loading = document.getElementById('loading-state');
            const error = document.getElementById('error-state');
            
            if (loading) loading.classList.add('hidden');
            if (error) error.classList.remove('hidden');
        }

        // ÈáçËØïÂä†ËΩΩÂáΩÊï∞
        function retryLoading() {
            console.log('üîÑ Retrying...');
            loadEvents();
        }

        // ‰∏ªË¶ÅÂä†ËΩΩÂáΩÊï∞
        async function loadEvents() {
            console.log('üöÄ Loading events from API...');
            
            try {
                const response = await fetch('http://localhost:3000/api/events');
                if (!response.ok) {
                    throw new Error(`HTTP error! status: ${response.status}`);
                }
                
                const data = await response.json();
                console.log('‚úÖ API response:', data);
                
                if (data.success && data.data && data.data.length > 0) {
                    displayEvents(data.data);
                } else {
                    showNoEvents();
                }
                
            } catch (error) {
                console.error('‚ùå Failed to load events:', error);
                showConnectionError();
            }
        }

        // È°µÈù¢Âä†ËΩΩÂÆåÊàêÂêéÊâßË°å
        document.addEventListener('DOMContentLoaded', function() {
            console.log('üè† Home page loaded - starting event loading...');
            loadEvents();
        });
    </script>
</body>
</html>